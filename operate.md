<!-- TOC -->

- [进程与线程](#进程与线程)
- [docker的四种网络模式](#docker的四种网络模式)
  - [host模式](#host模式)
  - [container模式](#container模式)
  - [none模式](#none模式)
  - [bridge模式](#bridge模式)
- [docker容器与外网通信](#docker容器与外网通信)
- [数据库索引](#数据库索引)

<!-- /TOC -->
## 进程与线程
* 一个程序至少有一个进程，一个进程至少有一个线程。
* 进程有自己的独立地址空间，每启动一个进程，系统就会进行分配空间，建立数据表等操作，开销很大。
* 线程共享进程中的数据，使用同样的地址空间，切换/创建线程的开销小很多，通信方便。
* 多线程程序只要一个线程挂掉，整个进程也会挂掉，而一个进程挂掉不会对独立地址空间的其他进程造成影响。

## docker的四种网络模式
docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP，Docker网桥是每个容器的默认网关，容器之前可以通过IP直接通信。
### host模式
如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。
缺点是宿主机上已经使用的端口不能再用，隔离性不好。
### container模式
新创建的容器与已经存在的一个容器共享一个network namespace，与该容器共享ip，端口范围
### none模式
Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。
### bridge模式
默认网络模式。从docker0分配一个IP给容器，设置docker0为容器的默认网关，在主机创建一对虚拟网卡，一段放在新创建的容器，命名为eth0，另一端放在主机，以vethxxx命名，并将这个网络加入docker0网桥

## docker容器与外网通信
容器默认可以访问外网：如果网桥 docker0 收到来自 172.17.0.0/16 网段的外出包，把它交给 MASQUERADE 处理。而 MASQUERADE 的处理方式是将包的源地址替换成 host 的地址发送出去，即做了一次网络地址转换（NAT）转换为 enp0s3的IP：10.0.2.15
外网访问容器：docker run -it -d --name=nginx01 -p 8081:80 nginx通过8081可以访问，使用了IPtables的DNAT功能，一些场景（ipv6，老内核）下使用docker-proxy。

## 数据库索引
索引用来快速查找具有特定值的记录，以B+树（平衡树）的形式保存。索引大大提高了查询速度，但是降低了更新表的速度。建立索引会占用磁盘空间，创建多种组合索引会占用大量空间。索引只是提高效率的一个因素，如果有大数据量的表，需要研究建立最优秀的索引，优化查询语句。

索引的类型
1. 普通索引：`CREATE INDEX index_name ON table_name (column_name)`
最基本的索引类型，而且它没有唯一性之类的限制，即允许该列有重复的值
2. 唯一性索引：`CREATE UNIQUE INDEX index_name ON table_name (column_name)`
3. 主键索引： `ALTER TABLE table_test ADD PRIMARY KEY (id)`
是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值，一般是在建表的时候同时自动创建主键索引
4. 组合索引：`ALTER TABLE table ADD INDEX name_city_age (name,city,age)`指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。使用组合索引时遵循最左前缀集合

* 聚集索引：如果给表上了主键，那么表在磁盘上的存储结构就由整齐排列的结构转变成了树状结构，也就是「平衡树」结构，换句话说，就是整个表就变成了一个索引，也就是所谓的「聚集索引」，一个表只能有一个聚集索引。
平衡树的查找次数是以树的层数为底，记录总数的对数
* 非聚集索引：同样采用平衡树作为索引的数据结构，各节点的值类源于索引字段值。每次给字段新建索引，字段数据会被复制一份用于生成索引。
* 通过聚集索引可以查到需要查找的数据， 而通过非聚集索引可以查到记录对应的主键值 ， 再使用主键的值通过聚集索引查找到需要的数据。
* 覆盖索引：也就是平时所说的复合索引或者多字段索引查询。当为字段建立索引以后，字段中的内容会被同步到索引之中，如果为一个索引指定两个字段，那么这个两个字段的内容都会被同步至索引之中。因此不需要通过主键ID值的查找数据行的真实所在，直接取得叶节点中查询字段的值返回即可。
